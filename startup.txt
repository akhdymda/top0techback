# 環境設定
export LD_LIBRARY_PATH="$LD_LIBRARY_PATH:/home/site/wwwroot/venv/lib/python3.12/site-packages"
export PYTHONPATH="$PYTHONPATH:/home/site/wwwroot"
export PIP_NO_BUILD_ISOLATION=false
export PIP_USE_PEP517=true

# システムの確認とデバッグ情報
echo "Python version:"
python --version
echo "Current directory:"
pwd
echo "File listing:"
ls -la

# 依存関係のインストール
echo "Installing dependencies..."
python -m pip install --upgrade pip==23.1.2
python -m pip install setuptools==67.8.0 wheel==0.40.0 --no-cache-dir
python -m pip install -r requirements.txt --no-build-isolation --no-cache-dir
echo "Dependencies installed successfully"

# ChromaDBの初期化
echo "Initializing ChromaDB..."
python init_chroma.py

# アプリの起動
echo "Starting FastAPI application..."
python -m uvicorn app:app --host 0.0.0.0
